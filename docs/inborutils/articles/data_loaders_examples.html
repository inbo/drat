<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>(Down)load data from external partners • inborutils</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">inborutils</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data_loaders_examples.html">(Down)load data from external partners</a>
    </li>
    <li>
      <a href="../articles/gbif_name_match.html">GBIF scientific name matching</a>
    </li>
    <li>
      <a href="../articles/guess_projection.html">Check coordinate system</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>(Down)load data from external partners</h1>
                        <h4 class="author">S. Van Hoey</h4>
            
            <h4 class="date">2017-12-19</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>We regularly get data sets (e.g. csv) from external partners with specific data formats. To overcome redundant work in writing custom functions to load these data sets, this vignette provides some examples for custom data readers provided by the <code>inborutils</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(inborutils)</code></pre></div>
</div>
<div id="knmi-data" class="section level2">
<h2 class="hasAnchor">
<a href="#knmi-data" class="anchor"></a>KNMI data</h2>
<p>The Dutch meteoroligcal institute, KNMI, provides a webservice to query and download data. <a href="https://www.knmi.nl/kennis-en-datacentrum/achtergrond/data-ophalen-vanuit-een-script">This tutorial</a> provides more information about their service.</p>
<p>For the hourly data, the R function <code>download_knmi_data_hour</code> facilitates the download of the data. To download data, the required inputs are the <code>stations</code>, <code>variables</code>, a <code>start_date</code> and an <code>end_date</code>.</p>
<p>In order to have an idea about the measurement stations that can be used, KNMI provides an overview list <a href="http://projects.knmi.nl/klimatologie/metadata/stationslijst.html">here</a>.</p>
<p>The variables, for which both a group name or a variable name can be used, also provided in the <a href="https://www.knmi.nl/kennis-en-datacentrum/achtergrond/data-ophalen-vanuit-een-script">KNMI documentation</a>:</p>
<table class="table">
<thead><tr class="header">
<th>group name</th>
<th>variable name</th>
<th>description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>WIND</td>
<td>DD:FH:FF:FX</td>
<td>wind</td>
</tr>
<tr class="even">
<td>TEMP</td>
<td>T:T10N:TD</td>
<td>temperature</td>
</tr>
<tr class="odd">
<td>SUNR</td>
<td>SQ:Q</td>
<td>sunlight duration, global radiation</td>
</tr>
<tr class="even">
<td>PRCP</td>
<td>DR:RH</td>
<td>rainfall, pet</td>
</tr>
<tr class="odd">
<td>VICL</td>
<td>VV:N:U</td>
<td>sight, cloudiness, relative humidity</td>
</tr>
<tr class="even">
<td>WEER</td>
<td>M:R:S:O:Y:WW</td>
<td>weather types</td>
</tr>
<tr class="odd">
<td>ALL</td>
<td></td>
<td>all variabelen</td>
</tr>
</tbody>
</table>
<p>Hence, for a given start (e.g. January 1st 2012) and end date (February 1st 2012), the data download for rainfall data in Vlissingen (<code>310</code>) and Wesdorpe (<code>319</code>), writing the output to a file called <code>knmi_download.csv</code>, can be started as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">response &lt;-<span class="st"> </span><span class="kw"><a href="../reference/download_knmi_data_hour.html">download_knmi_data_hour</a></span>(<span class="kw">c</span>(<span class="dv">310</span>, <span class="dv">319</span>), <span class="st">"PRCP"</span>,
                                    <span class="st">"2012-01-01"</span>, <span class="st">"2012-02-01"</span>,
                                    <span class="dt">output_file =</span> <span class="st">"knmi_download.csv"</span>)</code></pre></div>
<p>When chosen the rainfall data only, the package already includes a specific function to read the rainfall data (a more general functionality is on the <code>todo</code>-list, feel free to extend the existing function):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rain_knmi_<span class="dv">2012</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_knmi_rainfall.html">read_knmi_rainfall</a></span>(<span class="st">"./knmi_download.csv"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(rain_knmi_<span class="dv">2012</span>)</code></pre></div>
<pre><code>##   value            datetime unit variable_name longitude latitude
## 1  -1.0 2012-01-01 01:00:00   mm precipitation     3.596   51.442
## 2   1.7 2012-01-01 02:00:00   mm precipitation     3.596   51.442
## 3   0.4 2012-01-01 03:00:00   mm precipitation     3.596   51.442
## 4  -1.0 2012-01-01 04:00:00   mm precipitation     3.596   51.442
## 5   0.2 2012-01-01 05:00:00   mm precipitation     3.596   51.442
## 6   0.0 2012-01-01 06:00:00   mm precipitation     3.596   51.442
##   location_name   source_filename quality_code
## 1    VLISSINGEN knmi_download.csv             
## 2    VLISSINGEN knmi_download.csv             
## 3    VLISSINGEN knmi_download.csv             
## 4    VLISSINGEN knmi_download.csv             
## 5    VLISSINGEN knmi_download.csv             
## 6    VLISSINGEN knmi_download.csv</code></pre>
<p>From which a time series plot can be made:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(rain_knmi_<span class="dv">2012</span>, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> datetime, <span class="dt">y =</span> value)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">""</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"mm"</span>)</code></pre></div>
<p><img src="data_loaders_examples_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>From the figure, it gets clear that KNMI uses <code>-1</code> to define Nan values.</p>
</div>
<div id="mow-hic-data" class="section level2">
<h2 class="hasAnchor">
<a href="#mow-hic-data" class="anchor"></a>MOW-HIC data</h2>
<p>When receiving data from MOW (apart from using the waterinfo API), the file format of MOW data sets looks as follows:</p>
<pre><code>Station Name:   Destelbergen SF/Zeeschelde
Station Number: zes57n-SF-CM
River:  Zeeschelde
Operator:    -
Easting:    109591
Northing:   192793
Datum:  0.000
Parameter Name: Cond
Parameter Type: Cond
Time series Name:   Destelbergen SF/Zeeschelde / Cond / zes57n-SF.Cond.5
Time series Unit:   µS/cm
Time level: High-resolution
Time series Type:   Instantaneous value
Time series equidistant:    yes
Time series value distance: 5 Minute(s)
Time series quality:    2
Time series measuring system:   ---
Date    Time    Cond [µS/cm]    Quality flag    Comments
01/04/2015  00:00:00    631.996  G  
01/04/2015  00:05:00    631.007  G  
01/04/2015  00:10:00    632.993  G  
01/04/2015  00:15:00    631.004  G  
01/04/2015  00:20:00    631.996  G  
01/04/2015  00:25:00    631.004  G  
01/04/2015  00:30:00    632.000  G  
01/04/2015  00:35:00    632.000  G
...</code></pre>
<p>A lot of the information is provided in the header, which we would like to combine with the time series itself. The function <code>read_mow_data</code> is a tailor-made function to load this file format into a data.frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fpath &lt;-<span class="st"> "mow_example.txt"</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">conductivity_mow &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_mow_data.html">read_mow_data</a></span>(fpath)
<span class="kw">head</span>(conductivity_mow)</code></pre></div>
<pre><code>## # A tibble: 6 x 10
##              datetime   value quality_code quality_comments
##                &lt;dttm&gt;   &lt;dbl&gt;        &lt;chr&gt;            &lt;chr&gt;
## 1 2015-04-01 00:00:00 631.996            G             &lt;NA&gt;
## 2 2015-04-01 00:05:00 631.007            G             &lt;NA&gt;
## 3 2015-04-01 00:10:00 632.993            G             &lt;NA&gt;
## 4 2015-04-01 00:15:00 631.004            G             &lt;NA&gt;
## 5 2015-04-01 00:20:00 631.996            G             &lt;NA&gt;
## 6 2015-04-01 00:25:00 631.004            G             &lt;NA&gt;
## # ... with 6 more variables: location_name &lt;chr&gt;, variable_name &lt;chr&gt;,
## #   unit &lt;chr&gt;, longitude &lt;dbl&gt;, latitude &lt;dbl&gt;, source_filename &lt;chr&gt;</code></pre>
<p>(<em>Remark</em>: this example file is provided by the package itself, see also on <a href="https://github.com/inbo/inborutils/tree/master/inst/extdata">github</a>)</p>
<p>A time series plot can be made for these data as well:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(conductivity_mow, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x =</span> datetime, <span class="dt">y =</span> value)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">xlab</a></span>(<span class="st">""</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ylab</a></span>(<span class="st">"µS/cm"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_date">scale_x_datetime</a></span>(<span class="dt">date_labels =</span> <span class="st">"%H:%M</span><span class="ch">\n</span><span class="st">%Y-%m-%d"</span>, <span class="dt">date_breaks =</span> <span class="st">"4 hours"</span>)</code></pre></div>
<p><img src="data_loaders_examples_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
</div>
<div id="kmi-data" class="section level2">
<h2 class="hasAnchor">
<a href="#kmi-data" class="anchor"></a>KMI data</h2>
<p>When receiving data from the Belgian Meteorological Institute, KMI, the format of the data file looks as follows (at least for some project we did):</p>
<pre><code>date;JAAR;MAAND;DAG;UUR;STATION;NEERSLAG(mm)
2012-1-1_1;2012;1;1;1;SINT_KATELIJNE_WAVER;0
2012-1-1_2;2012;1;1;2;SINT_KATELIJNE_WAVER;0
2012-1-1_3;2012;1;1;3;SINT_KATELIJNE_WAVER;0
2012-1-1_4;2012;1;1;4;SINT_KATELIJNE_WAVER;0
2012-1-1_5;2012;1;1;5;SINT_KATELIJNE_WAVER;1.1
2012-1-1_6;2012;1;1;6;SINT_KATELIJNE_WAVER;0.2
2012-1-1_7;2012;1;1;7;SINT_KATELIJNE_WAVER;0
2012-1-1_8;2012;1;1;8;SINT_KATELIJNE_WAVER;0
2012-1-1_9;2012;1;1;9;SINT_KATELIJNE_WAVER;0
2012-1-1_10;2012;1;1;10;SINT_KATELIJNE_WAVER;0.8
2012-1-1_11;2012;1;1;11;SINT_KATELIJNE_WAVER;0.1
...</code></pre>
<p>To read the data and provide it into a similar format as the previous time series, the function <code>load_kmi_data</code> is available in the <code>inborutils</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rpath &lt;-<span class="st"> "kmi_example.txt"</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rainfall_kmi &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read_kmi_data.html">read_kmi_data</a></span>(rpath)
<span class="kw">head</span>(rainfall_kmi)</code></pre></div>
<pre><code>## # A tibble: 6 x 7
##              datetime        location_name value  unit variable_name
##                &lt;dttm&gt;                &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;
## 1 2012-01-01 01:00:00 SINT_KATELIJNE_WAVER   0.0    mm precipitation
## 2 2012-01-01 02:00:00 SINT_KATELIJNE_WAVER   0.0    mm precipitation
## 3 2012-01-01 03:00:00 SINT_KATELIJNE_WAVER   0.0    mm precipitation
## 4 2012-01-01 04:00:00 SINT_KATELIJNE_WAVER   0.0    mm precipitation
## 5 2012-01-01 05:00:00 SINT_KATELIJNE_WAVER   1.1    mm precipitation
## 6 2012-01-01 06:00:00 SINT_KATELIJNE_WAVER   0.2    mm precipitation
## # ... with 2 more variables: source_filename &lt;chr&gt;, quality_code &lt;chr&gt;</code></pre>
<p>(<em>Remark</em>: this example file is provided by the package itself, see also on <a href="https://github.com/inbo/inborutils/tree/master/inst/extdata">github</a>)</p>
</div>
<div id="closure" class="section level2">
<h2 class="hasAnchor">
<a href="#closure" class="anchor"></a>Closure</h2>
<p>Feel free to add other potentially useful data formats reader functions and associated documentation!</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#knmi-data">KNMI data</a></li>
      <li><a href="#mow-hic-data">MOW-HIC data</a></li>
      <li><a href="#kmi-data">KMI data</a></li>
      <li><a href="#closure">Closure</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Stijn Van Hoey, Pieter Verschelde.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
